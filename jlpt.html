<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>🎯 JLPT N5/N4 마스터</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .app { max-width: 500px; margin: 0 auto; background: #f8fafc; min-height: 100vh; }
    header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem; position: sticky; top: 0; z-index: 100; }
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
    .header-title { font-size: 1.25rem; font-weight: bold; }
    .header-controls { display: flex; gap: 0.5rem; align-items: center; }
    .header-controls select { padding: 0.25rem 0.5rem; border-radius: 0.5rem; border: none; font-size: 0.8rem; }
    .header-controls button { background: none; border: none; cursor: pointer; font-size: 1rem; }
    .level-tabs { display: flex; gap: 0.5rem; }
    .level-tab { flex: 1; padding: 0.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: bold; transition: all 0.2s; }
    .level-tab.n5 { background: rgba(255,255,255,0.2); color: white; }
    .level-tab.n5.active { background: #10b981; color: white; }
    .level-tab.n4 { background: rgba(255,255,255,0.2); color: white; }
    .level-tab.n4.active { background: #f59e0b; color: white; }
    .nav { display: flex; background: white; border-bottom: 1px solid #e5e7eb; overflow-x: auto; }
    .nav-btn { flex: 1; padding: 0.75rem 0.5rem; border: none; background: none; cursor: pointer; font-size: 0.8rem; color: #6b7280; border-bottom: 2px solid transparent; white-space: nowrap; }
    .nav-btn.active { color: #667eea; border-bottom-color: #667eea; font-weight: bold; }
    main { padding: 1rem; padding-bottom: 2rem; }
    .card { background: white; border-radius: 1rem; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .card-title { font-weight: bold; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
    .btn { padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s; }
    .btn-primary { background: #667eea; color: white; }
    .btn-green { background: #10b981; color: white; }
    .btn-orange { background: #f59e0b; color: white; }
    .btn-gray { background: #e5e7eb; color: #374151; }
    .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.75rem; }
    .btn-sound { background: #dbeafe; color: #2563eb; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.7rem; }
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
    .flex { display: flex; }
    .flex-wrap { flex-wrap: wrap; }
    .gap-1 { gap: 0.25rem; }
    .gap-2 { gap: 0.5rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .text-sm { font-size: 0.875rem; }
    .text-xs { font-size: 0.75rem; }
    .text-gray { color: #6b7280; }
    .text-center { text-align: center; }
    .font-bold { font-weight: bold; }
    /* 한자 카드 */
    .kanji-card { background: white; border-radius: 0.75rem; padding: 0.75rem; border: 1px solid #e5e7eb; }
    .kanji-char { font-size: 2.5rem; text-align: center; margin-bottom: 0.5rem; }
    .kanji-reading { font-size: 0.8rem; color: #667eea; margin-bottom: 0.25rem; }
    .kanji-meaning { font-size: 0.75rem; color: #374151; font-weight: bold; }
    .kanji-example { font-size: 0.7rem; color: #6b7280; margin-top: 0.25rem; }
    /* 문법 카드 */
    .grammar-card { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 0.75rem; padding: 1rem; margin-bottom: 0.75rem; }
    .grammar-pattern { font-size: 1.25rem; font-weight: bold; color: #0369a1; margin-bottom: 0.5rem; }
    .grammar-meaning { font-size: 0.9rem; color: #374151; margin-bottom: 0.5rem; }
    .grammar-example { background: white; border-radius: 0.5rem; padding: 0.75rem; margin-top: 0.5rem; }
    .grammar-jp { font-size: 1rem; margin-bottom: 0.25rem; }
    .grammar-kr { font-size: 0.8rem; color: #6b7280; }
    /* 어휘 카드 */
    .vocab-card { background: white; border-radius: 0.5rem; padding: 0.5rem 0.75rem; border: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
    .vocab-jp { font-size: 1rem; font-weight: bold; }
    .vocab-reading { font-size: 0.75rem; color: #667eea; }
    .vocab-kr { font-size: 0.8rem; color: #6b7280; }
    /* 서브탭 */
    .sub-tabs { display: flex; flex-wrap: wrap; gap: 0.25rem; margin-bottom: 0.75rem; }
    .sub-tab { padding: 0.375rem 0.75rem; border-radius: 1rem; border: none; font-size: 0.75rem; cursor: pointer; background: #e5e7eb; color: #374151; }
    .sub-tab.active { background: #667eea; color: white; }
    /* 퀴즈 */
    .quiz-option { width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; background: white; cursor: pointer; font-size: 1rem; margin-bottom: 0.5rem; transition: all 0.2s; }
    .quiz-option:hover { border-color: #667eea; }
    .quiz-option.correct { background: #dcfce7; border-color: #22c55e; }
    .quiz-option.wrong { background: #fee2e2; border-color: #ef4444; }
    /* 진행바 */
    .progress-bar { height: 0.5rem; background: #e5e7eb; border-radius: 1rem; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s; }
    /* 하단 네비게이션 */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 100; }
    .bottom-nav-inner { display: flex; justify-content: space-around; max-width: 500px; margin: 0 auto; padding: 0.5rem 0; }
    .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.5rem; border: none; background: none; color: #9ca3af; font-size: 0.7rem; cursor: pointer; text-decoration: none; min-width: 60px; }
    .nav-btn.active { color: #667eea; }
    .nav-btn span:first-child { font-size: 1.25rem; }
    .add-toast { position: fixed; bottom: 5rem; left: 50%; transform: translateX(-50%); background: #4CAF50; color: white; padding: 1rem 2rem; border-radius: 10px; z-index: 9999; animation: fadeInOut 2s; }
    @keyframes fadeInOut { 0%,100% { opacity: 0; } 10%,90% { opacity: 1; } }
    /* 로그인 */
    .login-btn { display: flex; align-items: center; gap: 0.5rem; padding: 0.3rem 0.6rem; background: rgba(255,255,255,0.2); border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.75rem; color: white; }
    .user-info { display: flex; align-items: center; gap: 0.4rem; }
    .user-avatar { width: 1.5rem; height: 1.5rem; border-radius: 50%; }
    .user-name { font-size: 0.7rem; color: white; max-width: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .sync-icon { font-size: 0.7rem; }
    .dropdown { position: relative; }
    .dropdown-menu { position: absolute; top: 100%; right: 0; background: white; border-radius: 0.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.2); min-width: 130px; z-index: 200; display: none; margin-top: 0.5rem; }
    .dropdown-menu.show { display: block; }
    .dropdown-item { padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.8rem; color: #374151; }
    .dropdown-item:hover { background: #f3f4f6; }
  </style>
</head>
<body>
<div class="app" id="app" style="padding-bottom: 70px;"></div>
<nav class="bottom-nav">
  <div class="bottom-nav-inner">
    <a href="index.html" class="nav-btn"><span>🏠</span><span>홈</span></a>
    <button class="nav-btn" id="navN5" onclick="setLevel('n5')"><span>🟢</span><span>N5</span></button>
    <button class="nav-btn" id="navN4" onclick="setLevel('n4')"><span>🟠</span><span>N4</span></button>
    <a href="notebook.html" class="nav-btn"><span>📖</span><span>단어장</span></a>
  </div>
</nav>
<script src="romaji.js"></script>
<script src="n5-vocab.js"></script>
<script src="n4-vocab.js"></script>
<script src="notebook.js"></script>
<script>

// ========== 프로필 시스템 (index.html과 공유) ==========
let currentProfile = localStorage.getItem('currentProfile') || '기본';
let profiles = JSON.parse(localStorage.getItem('profiles') || '["기본"]');

function getStorageKey(key) { return 'jlpt_' + currentProfile + '_' + key; }

function switchProfile(name) {
  currentProfile = name;
  localStorage.setItem('currentProfile', name);
  loadProgress();
  quizState = { type: 'kanji', questions: [], current: 0, score: 0, answered: false, selected: null };
  render();
}

function addProfile() {
  const name = prompt('새 프로필 이름:');
  if (name && name.trim() && !profiles.includes(name.trim())) {
    profiles.push(name.trim());
    localStorage.setItem('profiles', JSON.stringify(profiles));
    currentProfile = name.trim();
    localStorage.setItem('currentProfile', currentProfile);
    // 새 프로필 진행도 초기화
    progress = { n5: { kanji: [], vocab: [], grammar: [] }, n4: { kanji: [], vocab: [], grammar: [] } };
    localStorage.setItem(getStorageKey('progress'), JSON.stringify(progress));
    quizState = { type: 'kanji', questions: [], current: 0, score: 0, answered: false, selected: null };
    render();
  }
}

function resetProgress() {
  if (confirm(`"${currentProfile}" 프로필의 학습 진행도를 초기화할까요?`)) {
    progress = { n5: { kanji: [], vocab: [], grammar: [] }, n4: { kanji: [], vocab: [], grammar: [] } };
    localStorage.setItem(getStorageKey('progress'), JSON.stringify(progress));
    quizState = { type: 'kanji', questions: [], current: 0, score: 0, answered: false, selected: null };
    render();
    alert('초기화 완료!');
  }
}

// ========== 진행도 ==========
let progress = { n5: { kanji: [], vocab: [], grammar: [] }, n4: { kanji: [], vocab: [], grammar: [] } };

function loadProgress() {
  try {
    const saved = localStorage.getItem(getStorageKey('progress'));
    if (saved) progress = JSON.parse(saved);
    else progress = { n5: { kanji: [], vocab: [], grammar: [] }, n4: { kanji: [], vocab: [], grammar: [] } };
  } catch(e) { 
    progress = { n5: { kanji: [], vocab: [], grammar: [] }, n4: { kanji: [], vocab: [], grammar: [] } };
  }
}

function saveProgress() {
  localStorage.setItem(getStorageKey('progress'), JSON.stringify(progress));
  if (window.autoSaveToCloud) window.autoSaveToCloud();
}

// 섹션별 리셋 함수
function resetSection(level, section) {
  if (confirm(`${level.toUpperCase()} ${section} 진행도를 초기화할까요?`)) {
    progress[level][section] = [];
    saveProgress();
    render();
  }
}

// 퀴즈 리셋 (점수 초기화)
function resetQuiz() {
  if (confirm('퀴즈를 처음부터 다시 시작할까요? 점수가 초기화됩니다.')) {
    quizState = { type: null, questions: [], current: 0, score: 0, answered: false, selected: null };
    render();
  }
}

// 퀴즈 홈으로 (진행도 유지)
function goQuizHome() {
  quizState.questions = [];
  quizState.current = 0;
  quizState.answered = false;
  quizState.selected = null;
  // score는 유지
  render();
}

function markLearned(level, section, index) {
  if (!progress[level][section]) progress[level][section] = [];
  if (!progress[level][section].includes(index)) {
    progress[level][section].push(index);
    saveProgress();
  }
}

function isLearned(level, section, index) {
  return progress[level]?.[section]?.includes(index) || false;
}

// ========== 상태 ==========
let state = {
  level: 'n5',
  section: 'kanji',
  subSection: 'all',
  page: 1,
  quizMode: false,
  quizData: null
};

const ITEMS_PER_PAGE = 10;

function setPage(p) {
  state.page = p;
  render();
  window.scrollTo(0, 0);
}

function renderPagination(totalItems) {
  const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
  if (totalPages <= 1) return '';
  
  let pages = [];
  for (let i = 1; i <= totalPages; i++) {
    if (i === 1 || i === totalPages || (i >= state.page - 2 && i <= state.page + 2)) {
      pages.push(i);
    } else if (pages[pages.length - 1] !== '...') {
      pages.push('...');
    }
  }
  
  return `
    <div style="display:flex;justify-content:center;gap:0.25rem;margin-top:1rem;flex-wrap:wrap">
      <button class="btn btn-sm ${state.page === 1 ? 'btn-gray' : 'btn-primary'}" 
        onclick="setPage(${state.page - 1})" ${state.page === 1 ? 'disabled' : ''}>◀</button>
      ${pages.map(p => p === '...' 
        ? `<span style="padding:0.375rem">...</span>`
        : `<button class="btn btn-sm ${state.page === p ? 'btn-primary' : 'btn-gray'}" onclick="setPage(${p})">${p}</button>`
      ).join('')}
      <button class="btn btn-sm ${state.page === totalPages ? 'btn-gray' : 'btn-primary'}" 
        onclick="setPage(${state.page + 1})" ${state.page === totalPages ? 'disabled' : ''}>▶</button>
    </div>
    <div class="text-center text-xs text-gray" style="margin-top:0.5rem">${state.page} / ${totalPages} 페이지</div>
  `;
}

// ========== 발음 (TTS) ==========
function speak(text, rate = 0.8) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'ja-JP';
  u.rate = rate;
  window.speechSynthesis.speak(u);
}


// ==================== N5 한자 (103자) ====================
const N5_KANJI = [
  // 숫자
  {k:'一',o:'イチ',u:'ひと(つ)',m:'하나, 1',ex:'一人(ひとり)한 사람'},
  {k:'二',o:'ニ',u:'ふた(つ)',m:'둘, 2',ex:'二月(にがつ)2월'},
  {k:'三',o:'サン',u:'み(っつ)',m:'셋, 3',ex:'三日(みっか)3일'},
  {k:'四',o:'シ/ヨン',u:'よ(っつ)',m:'넷, 4',ex:'四月(しがつ)4월'},
  {k:'五',o:'ゴ',u:'いつ(つ)',m:'다섯, 5',ex:'五人(ごにん)5명'},
  {k:'六',o:'ロク',u:'む(っつ)',m:'여섯, 6',ex:'六日(むいか)6일'},
  {k:'七',o:'シチ/ナナ',u:'なな(つ)',m:'일곱, 7',ex:'七月(しちがつ)7월'},
  {k:'八',o:'ハチ',u:'や(っつ)',m:'여덟, 8',ex:'八百(はっぴゃく)800'},
  {k:'九',o:'キュウ/ク',u:'ここの(つ)',m:'아홉, 9',ex:'九月(くがつ)9월'},
  {k:'十',o:'ジュウ',u:'とお',m:'열, 10',ex:'十日(とおか)10일'},
  {k:'百',o:'ヒャク',u:'-',m:'백, 100',ex:'百円(ひゃくえん)백엔'},
  {k:'千',o:'セン',u:'ち',m:'천, 1000',ex:'千円(せんえん)천엔'},
  {k:'万',o:'マン',u:'-',m:'만, 10000',ex:'一万(いちまん)일만'},
  {k:'円',o:'エン',u:'まる(い)',m:'엔, 원',ex:'五百円(ごひゃくえん)'},
  // 요일/시간
  {k:'日',o:'ニチ/ジツ',u:'ひ/か',m:'날, 해',ex:'日曜日(にちようび)일요일'},
  {k:'月',o:'ゲツ/ガツ',u:'つき',m:'달, 월',ex:'月曜日(げつようび)월요일'},
  {k:'火',o:'カ',u:'ひ',m:'불',ex:'火曜日(かようび)화요일'},
  {k:'水',o:'スイ',u:'みず',m:'물',ex:'水曜日(すいようび)수요일'},
  {k:'木',o:'モク/ボク',u:'き',m:'나무',ex:'木曜日(もくようび)목요일'},
  {k:'金',o:'キン/コン',u:'かね',m:'금, 돈',ex:'金曜日(きんようび)금요일'},
  {k:'土',o:'ド/ト',u:'つち',m:'흙',ex:'土曜日(どようび)토요일'},
  {k:'年',o:'ネン',u:'とし',m:'해, 년',ex:'今年(ことし)올해'},
  {k:'時',o:'ジ',u:'とき',m:'때, 시',ex:'時間(じかん)시간'},
  {k:'分',o:'フン/ブン',u:'わ(かる)',m:'분, 나누다',ex:'十分(じゅっぷん)10분'},
  {k:'半',o:'ハン',u:'-',m:'반',ex:'半分(はんぶん)반'},
  {k:'毎',o:'マイ',u:'-',m:'매',ex:'毎日(まいにち)매일'},
  {k:'今',o:'コン/キン',u:'いま',m:'지금',ex:'今日(きょう)오늘'},
  {k:'先',o:'セン',u:'さき',m:'먼저',ex:'先生(せんせい)선생님'},
  {k:'来',o:'ライ',u:'く(る)',m:'오다',ex:'来年(らいねん)내년'},
  {k:'週',o:'シュウ',u:'-',m:'주',ex:'今週(こんしゅう)이번주'},
  {k:'午',o:'ゴ',u:'-',m:'낮',ex:'午後(ごご)오후'},
  {k:'前',o:'ゼン',u:'まえ',m:'앞',ex:'午前(ごぜん)오전'},
  {k:'後',o:'ゴ/コウ',u:'あと/うし(ろ)',m:'뒤',ex:'午後(ごご)오후'},
  // 사람/가족
  {k:'人',o:'ジン/ニン',u:'ひと',m:'사람',ex:'日本人(にほんじん)일본인'},
  {k:'男',o:'ダン/ナン',u:'おとこ',m:'남자',ex:'男の子(おとこのこ)남자아이'},
  {k:'女',o:'ジョ/ニョ',u:'おんな',m:'여자',ex:'女の人(おんなのひと)여자'},
  {k:'子',o:'シ/ス',u:'こ',m:'아이',ex:'子供(こども)아이'},
  {k:'父',o:'フ',u:'ちち',m:'아버지',ex:'お父さん(おとうさん)아버지'},
  {k:'母',o:'ボ',u:'はは',m:'어머니',ex:'お母さん(おかあさん)어머니'},
  {k:'友',o:'ユウ',u:'とも',m:'친구',ex:'友達(ともだち)친구'},
  // 자연
  {k:'山',o:'サン',u:'やま',m:'산',ex:'富士山(ふじさん)후지산'},
  {k:'川',o:'セン',u:'かわ',m:'강',ex:'川(かわ)강'},
  {k:'天',o:'テン',u:'あめ/あま',m:'하늘',ex:'天気(てんき)날씨'},
  {k:'気',o:'キ/ケ',u:'-',m:'기운',ex:'元気(げんき)건강'},
  {k:'雨',o:'ウ',u:'あめ',m:'비',ex:'雨(あめ)비'},
  {k:'電',o:'デン',u:'-',m:'전기',ex:'電話(でんわ)전화'},
  {k:'車',o:'シャ',u:'くるま',m:'차',ex:'電車(でんしゃ)전철'},
  {k:'国',o:'コク',u:'くに',m:'나라',ex:'外国(がいこく)외국'},
  {k:'外',o:'ガイ/ゲ',u:'そと/ほか',m:'바깥',ex:'外国人(がいこくじん)외국인'},
  // 방향/위치
  {k:'上',o:'ジョウ',u:'うえ/あ(がる)',m:'위',ex:'上(うえ)위'},
  {k:'下',o:'カ/ゲ',u:'した/さ(がる)',m:'아래',ex:'下(した)아래'},
  {k:'中',o:'チュウ',u:'なか',m:'안, 중',ex:'中(なか)안'},
  {k:'右',o:'ウ/ユウ',u:'みぎ',m:'오른쪽',ex:'右(みぎ)오른쪽'},
  {k:'左',o:'サ',u:'ひだり',m:'왼쪽',ex:'左(ひだり)왼쪽'},
  {k:'北',o:'ホク',u:'きた',m:'북쪽',ex:'北(きた)북쪽'},
  {k:'南',o:'ナン',u:'みなみ',m:'남쪽',ex:'南(みなみ)남쪽'},
  {k:'東',o:'トウ',u:'ひがし',m:'동쪽',ex:'東京(とうきょう)도쿄'},
  {k:'西',o:'セイ/サイ',u:'にし',m:'서쪽',ex:'西(にし)서쪽'},
  // 장소
  {k:'駅',o:'エキ',u:'-',m:'역',ex:'駅(えき)역'},
  {k:'店',o:'テン',u:'みせ',m:'가게',ex:'店(みせ)가게'},
  {k:'校',o:'コウ',u:'-',m:'학교',ex:'学校(がっこう)학교'},
  {k:'学',o:'ガク',u:'まな(ぶ)',m:'배우다',ex:'学生(がくせい)학생'},
  {k:'生',o:'セイ/ショウ',u:'い(きる)/う(まれる)',m:'살다, 나다',ex:'先生(せんせい)선생님'},
  {k:'会',o:'カイ',u:'あ(う)',m:'만나다',ex:'会社(かいしゃ)회사'},
  {k:'社',o:'シャ',u:'-',m:'회사',ex:'会社(かいしゃ)회사'},
  {k:'道',o:'ドウ',u:'みち',m:'길',ex:'道(みち)길'},
  // 동작
  {k:'行',o:'コウ/ギョウ',u:'い(く)/おこな(う)',m:'가다',ex:'行く(いく)가다'},
  {k:'来',o:'ライ',u:'く(る)/き(たる)',m:'오다',ex:'来る(くる)오다'},
  {k:'出',o:'シュツ',u:'で(る)/だ(す)',m:'나가다',ex:'出る(でる)나가다'},
  {k:'入',o:'ニュウ',u:'はい(る)/い(れる)',m:'들어가다',ex:'入る(はいる)들어가다'},
  {k:'食',o:'ショク',u:'た(べる)',m:'먹다',ex:'食べる(たべる)먹다'},
  {k:'飲',o:'イン',u:'の(む)',m:'마시다',ex:'飲む(のむ)마시다'},
  {k:'見',o:'ケン',u:'み(る)',m:'보다',ex:'見る(みる)보다'},
  {k:'聞',o:'ブン/モン',u:'き(く)',m:'듣다',ex:'聞く(きく)듣다'},
  {k:'読',o:'ドク',u:'よ(む)',m:'읽다',ex:'読む(よむ)읽다'},
  {k:'書',o:'ショ',u:'か(く)',m:'쓰다',ex:'書く(かく)쓰다'},
  {k:'話',o:'ワ',u:'はな(す)/はなし',m:'말하다',ex:'話す(はなす)말하다'},
  {k:'言',o:'ゲン/ゴン',u:'い(う)/こと',m:'말하다',ex:'言う(いう)말하다'},
  {k:'買',o:'バイ',u:'か(う)',m:'사다',ex:'買う(かう)사다'},
  {k:'休',o:'キュウ',u:'やす(む)',m:'쉬다',ex:'休む(やすむ)쉬다'},
  {k:'立',o:'リツ',u:'た(つ)',m:'서다',ex:'立つ(たつ)서다'},
  {k:'待',o:'タイ',u:'ま(つ)',m:'기다리다',ex:'待つ(まつ)기다리다'},
  {k:'持',o:'ジ',u:'も(つ)',m:'갖다',ex:'持つ(もつ)갖다'},
  {k:'使',o:'シ',u:'つか(う)',m:'쓰다, 사용하다',ex:'使う(つかう)쓰다'},
  {k:'作',o:'サク',u:'つく(る)',m:'만들다',ex:'作る(つくる)만들다'},
  {k:'知',o:'チ',u:'し(る)',m:'알다',ex:'知る(しる)알다'},
  {k:'思',o:'シ',u:'おも(う)',m:'생각하다',ex:'思う(おもう)생각하다'},
  // 형용사 관련
  {k:'大',o:'ダイ/タイ',u:'おお(きい)',m:'크다',ex:'大きい(おおきい)크다'},
  {k:'小',o:'ショウ',u:'ちい(さい)/こ',m:'작다',ex:'小さい(ちいさい)작다'},
  {k:'多',o:'タ',u:'おお(い)',m:'많다',ex:'多い(おおい)많다'},
  {k:'少',o:'ショウ',u:'すく(ない)/すこ(し)',m:'적다',ex:'少ない(すくない)적다'},
  {k:'高',o:'コウ',u:'たか(い)',m:'높다, 비싸다',ex:'高い(たかい)비싸다'},
  {k:'安',o:'アン',u:'やす(い)',m:'싸다, 평안',ex:'安い(やすい)싸다'},
  {k:'新',o:'シン',u:'あたら(しい)',m:'새롭다',ex:'新しい(あたらしい)새롭다'},
  {k:'古',o:'コ',u:'ふる(い)',m:'오래되다',ex:'古い(ふるい)오래되다'},
  {k:'長',o:'チョウ',u:'なが(い)',m:'길다',ex:'長い(ながい)길다'},
  {k:'短',o:'タン',u:'みじか(い)',m:'짧다',ex:'短い(みじかい)짧다'},
  {k:'白',o:'ハク/ビャク',u:'しろ(い)',m:'하얗다',ex:'白い(しろい)하얗다'},
  {k:'黒',o:'コク',u:'くろ(い)',m:'검다',ex:'黒い(くろい)검다'},
  {k:'赤',o:'セキ',u:'あか(い)',m:'빨갛다',ex:'赤い(あかい)빨갛다'},
  {k:'青',o:'セイ',u:'あお(い)',m:'파랗다',ex:'青い(あおい)파랗다'},
  // 기타 필수
  {k:'何',o:'カ',u:'なに/なん',m:'무엇',ex:'何(なに)무엇'},
  {k:'本',o:'ホン',u:'もと',m:'책, 본',ex:'本(ほん)책'},
  {k:'名',o:'メイ/ミョウ',u:'な',m:'이름',ex:'名前(なまえ)이름'},
  {k:'語',o:'ゴ',u:'かた(る)',m:'말, 언어',ex:'日本語(にほんご)일본어'},
  {k:'間',o:'カン/ケン',u:'あいだ/ま',m:'사이',ex:'時間(じかん)시간'},
  {k:'花',o:'カ',u:'はな',m:'꽃',ex:'花(はな)꽃'},
  {k:'魚',o:'ギョ',u:'さかな/うお',m:'물고기',ex:'魚(さかな)생선'},
  {k:'肉',o:'ニク',u:'-',m:'고기',ex:'肉(にく)고기'},
  {k:'足',o:'ソク',u:'あし/た(りる)',m:'발, 충분하다',ex:'足(あし)발'},
  {k:'手',o:'シュ',u:'て',m:'손',ex:'手(て)손'},
  {k:'目',o:'モク/ボク',u:'め',m:'눈',ex:'目(め)눈'},
  {k:'耳',o:'ジ',u:'みみ',m:'귀',ex:'耳(みみ)귀'},
  {k:'口',o:'コウ/ク',u:'くち',m:'입',ex:'口(くち)입'},
  {k:'体',o:'タイ',u:'からだ',m:'몸',ex:'体(からだ)몸'},
  {k:'空',o:'クウ',u:'そら/あ(く)',m:'하늘, 비다',ex:'空(そら)하늘'},
  {k:'海',o:'カイ',u:'うみ',m:'바다',ex:'海(うみ)바다'},
];


// ==================== N5 문법 ====================
const N5_GRAMMAR = [
  {pt:'~です',m:'~입니다',d:'명사/な형용사 + です',ex:[
    {jp:'わたしは学生です。',kr:'저는 학생입니다.'},
    {jp:'これは本です。',kr:'이것은 책입니다.'}
  ]},
  {pt:'~ます',m:'~합니다',d:'동사의 정중체',ex:[
    {jp:'毎日勉強します。',kr:'매일 공부합니다.'},
    {jp:'朝ごはんを食べます。',kr:'아침밥을 먹습니다.'}
  ]},
  {pt:'~ません',m:'~하지 않습니다',d:'동사 부정(정중체)',ex:[
    {jp:'肉を食べません。',kr:'고기를 먹지 않습니다.'},
    {jp:'お酒を飲みません。',kr:'술을 마시지 않습니다.'}
  ]},
  {pt:'~ました',m:'~했습니다',d:'동사 과거(정중체)',ex:[
    {jp:'昨日映画を見ました。',kr:'어제 영화를 봤습니다.'},
    {jp:'日本に行きました。',kr:'일본에 갔습니다.'}
  ]},
  {pt:'~たい',m:'~하고 싶다',d:'희망 표현',ex:[
    {jp:'日本に行きたいです。',kr:'일본에 가고 싶습니다.'},
    {jp:'水が飲みたい。',kr:'물이 마시고 싶다.'}
  ]},
  {pt:'~てください',m:'~해 주세요',d:'부탁/요청',ex:[
    {jp:'ここに名前を書いてください。',kr:'여기에 이름을 써 주세요.'},
    {jp:'ゆっくり話してください。',kr:'천천히 말해 주세요.'}
  ]},
  {pt:'~ている',m:'~하고 있다',d:'진행/상태',ex:[
    {jp:'今、本を読んでいます。',kr:'지금 책을 읽고 있습니다.'},
    {jp:'東京に住んでいます。',kr:'도쿄에 살고 있습니다.'}
  ]},
  {pt:'~てもいい',m:'~해도 된다',d:'허락',ex:[
    {jp:'写真を撮ってもいいですか。',kr:'사진을 찍어도 될까요?'},
    {jp:'ここに座ってもいいですよ。',kr:'여기에 앉아도 돼요.'}
  ]},
  {pt:'~てはいけない',m:'~하면 안 된다',d:'금지',ex:[
    {jp:'ここで写真を撮ってはいけません。',kr:'여기서 사진을 찍으면 안 됩니다.'},
    {jp:'タバコを吸ってはいけない。',kr:'담배를 피우면 안 된다.'}
  ]},
  {pt:'~なければならない',m:'~해야 한다',d:'의무',ex:[
    {jp:'薬を飲まなければなりません。',kr:'약을 먹어야 합니다.'},
    {jp:'早く起きなければならない。',kr:'일찍 일어나야 한다.'}
  ]},
  {pt:'~ましょう',m:'~합시다',d:'권유/제안',ex:[
    {jp:'一緒に昼ごはんを食べましょう。',kr:'같이 점심을 먹읍시다.'},
    {jp:'映画を見に行きましょう。',kr:'영화를 보러 갑시다.'}
  ]},
  {pt:'~から',m:'~때문에',d:'이유',ex:[
    {jp:'暑いですから、窓を開けてください。',kr:'더우니까 창문을 열어 주세요.'},
    {jp:'テストがありますから、勉強します。',kr:'시험이 있으니까 공부합니다.'}
  ]},
  {pt:'~と思う',m:'~라고 생각하다',d:'의견/생각',ex:[
    {jp:'明日は雨だと思います。',kr:'내일은 비라고 생각합니다.'},
    {jp:'日本語は難しいと思う。',kr:'일본어는 어렵다고 생각한다.'}
  ]},
  {pt:'~ことができる',m:'~할 수 있다',d:'가능',ex:[
    {jp:'日本語を話すことができます。',kr:'일본어를 말할 수 있습니다.'},
    {jp:'車を運転することができる。',kr:'차를 운전할 수 있다.'}
  ]},
  {pt:'~前に',m:'~전에',d:'시간 순서',ex:[
    {jp:'寝る前に歯を磨きます。',kr:'자기 전에 이를 닦습니다.'},
    {jp:'食べる前に手を洗う。',kr:'먹기 전에 손을 씻는다.'}
  ]},
  {pt:'~後で',m:'~후에',d:'시간 순서',ex:[
    {jp:'食べた後で、散歩します。',kr:'먹은 후에 산책합니다.'},
    {jp:'授業の後で会いましょう。',kr:'수업 후에 만납시다.'}
  ]},
  {pt:'~ながら',m:'~하면서',d:'동시 동작',ex:[
    {jp:'音楽を聞きながら勉強する。',kr:'음악을 들으면서 공부한다.'},
    {jp:'歩きながら話しましょう。',kr:'걸으면서 이야기합시다.'}
  ]},
  {pt:'~たり~たりする',m:'~하거나 ~하다',d:'열거',ex:[
    {jp:'週末は映画を見たり、買い物をしたりします。',kr:'주말에는 영화를 보거나 쇼핑을 합니다.'},
    {jp:'本を読んだり、音楽を聞いたりする。',kr:'책을 읽거나 음악을 듣는다.'}
  ]},
  {pt:'~に行く/来る',m:'~하러 가다/오다',d:'목적',ex:[
    {jp:'映画を見に行きます。',kr:'영화를 보러 갑니다.'},
    {jp:'友達に会いに来ました。',kr:'친구를 만나러 왔습니다.'}
  ]},
  {pt:'~は~が~',m:'~은 ~가 ~하다',d:'주제+주어',ex:[
    {jp:'私は日本語が好きです。',kr:'저는 일본어를 좋아합니다.'},
    {jp:'象は鼻が長い。',kr:'코끼리는 코가 길다.'}
  ]},
  {pt:'~より~のほうが',m:'~보다 ~이 더',d:'비교',ex:[
    {jp:'電車よりバスのほうが安い。',kr:'전철보다 버스가 더 싸다.'},
    {jp:'夏より冬のほうが好きです。',kr:'여름보다 겨울을 더 좋아합니다.'}
  ]},
  {pt:'~で一番',m:'~에서 가장',d:'최상급',ex:[
    {jp:'日本で一番高い山は富士山です。',kr:'일본에서 가장 높은 산은 후지산입니다.'},
    {jp:'クラスで一番背が高い。',kr:'반에서 가장 키가 크다.'}
  ]},
  {pt:'~つもり',m:'~할 생각이다',d:'의도/계획',ex:[
    {jp:'来年日本に行くつもりです。',kr:'내년에 일본에 갈 생각입니다.'},
    {jp:'大学院に進むつもりだ。',kr:'대학원에 진학할 생각이다.'}
  ]},
  {pt:'~ないでください',m:'~하지 마세요',d:'부정 요청',ex:[
    {jp:'ここで写真を撮らないでください。',kr:'여기서 사진을 찍지 마세요.'},
    {jp:'心配しないでください。',kr:'걱정하지 마세요.'}
  ]},
  {pt:'~くなる/~になる',m:'~해지다',d:'상태 변화',ex:[
    {jp:'日本語が上手になりました。',kr:'일본어가 잘하게 되었습니다.'},
    {jp:'寒くなりましたね。',kr:'추워졌네요.'}
  ]},
  {pt:'~すぎる',m:'너무 ~하다',d:'과도함',ex:[
    {jp:'食べすぎました。',kr:'너무 많이 먹었습니다.'},
    {jp:'この服は高すぎる。',kr:'이 옷은 너무 비싸다.'}
  ]},
  {pt:'~やすい/~にくい',m:'~하기 쉽다/어렵다',d:'난이도',ex:[
    {jp:'この本は読みやすいです。',kr:'이 책은 읽기 쉽습니다.'},
    {jp:'この漢字は覚えにくい。',kr:'이 한자는 외우기 어렵다.'}
  ]},
  {pt:'~方',m:'~하는 방법',d:'방법',ex:[
    {jp:'使い方を教えてください。',kr:'사용법을 알려주세요.'},
    {jp:'作り方が分からない。',kr:'만드는 방법을 모른다.'}
  ]},
  {pt:'~ても',m:'~해도',d:'역접 조건',ex:[
    {jp:'雨が降っても行きます。',kr:'비가 와도 갑니다.'},
    {jp:'いくら食べても太らない。',kr:'아무리 먹어도 안 찐다.'}
  ]},
  {pt:'~そうだ(전문)',m:'~라고 한다',d:'전해들은 정보',ex:[
    {jp:'明日は雨だそうです。',kr:'내일은 비라고 합니다.'},
    {jp:'彼は来月結婚するそうだ。',kr:'그는 다음 달 결혼한다고 한다.'}
  ]},
  {pt:'~し',m:'~하고, ~해서',d:'이유 나열',ex:[
    {jp:'安いし、おいしいし、最高です。',kr:'싸고, 맛있고, 최고입니다.'},
    {jp:'時間もないし、お金もない。',kr:'시간도 없고, 돈도 없다.'}
  ]},
  {pt:'~のに',m:'~인데도',d:'역접',ex:[
    {jp:'約束したのに来なかった。',kr:'약속했는데 오지 않았다.'},
    {jp:'高いのに売れている。',kr:'비싼데도 팔리고 있다.'}
  ]},
  {pt:'~かもしれない',m:'~일지도 모른다',d:'불확실한 추측',ex:[
    {jp:'明日は雨かもしれません。',kr:'내일은 비일지도 모릅니다.'},
    {jp:'彼は知らないかもしれない。',kr:'그는 모를지도 모른다.'}
  ]},
  {pt:'~でしょう',m:'~겠지요',d:'추측/확인',ex:[
    {jp:'明日は晴れるでしょう。',kr:'내일은 맑겠지요.'},
    {jp:'これは高いでしょう？',kr:'이거 비싸죠?'}
  ]},
  {pt:'~らしい',m:'~인 것 같다',d:'추측(간접)',ex:[
    {jp:'彼女は忙しいらしい。',kr:'그녀는 바쁜 것 같다.'},
    {jp:'電車が遅れているらしいです。',kr:'전철이 늦어지고 있는 것 같습니다.'}
  ]},
  {pt:'~んです/~のです',m:'~거든요/~인 거예요',d:'설명/강조',ex:[
    {jp:'どうしたんですか。',kr:'어떻게 된 거예요?'},
    {jp:'電車が遅れたのです。',kr:'전철이 늦은 거예요.'}
  ]},
  {pt:'~てあげる',m:'~해 주다(내가)',d:'수수표현',ex:[
    {jp:'友達に本を貸してあげました。',kr:'친구에게 책을 빌려줬습니다.'},
    {jp:'道を教えてあげる。',kr:'길을 알려줄게.'}
  ]},
  {pt:'~てもらう',m:'~해 받다',d:'수수표현',ex:[
    {jp:'友達に手伝ってもらいました。',kr:'친구에게 도움을 받았습니다.'},
    {jp:'先生に教えてもらった。',kr:'선생님께 배웠다.'}
  ]},
  {pt:'~てくれる',m:'~해 주다(남이)',d:'수수표현',ex:[
    {jp:'母が作ってくれました。',kr:'어머니가 만들어 주셨습니다.'},
    {jp:'友達が助けてくれた。',kr:'친구가 도와줬다.'}
  ]},
  {pt:'~てほしい',m:'~해 줬으면 한다',d:'희망(타인에게)',ex:[
    {jp:'早く来てほしいです。',kr:'빨리 와줬으면 합니다.'},
    {jp:'静かにしてほしい。',kr:'조용히 해줬으면 해.'}
  ]},
  {pt:'~ところ',m:'막 ~하는 중',d:'시점',ex:[
    {jp:'今、食べているところです。',kr:'지금 막 먹고 있는 중입니다.'},
    {jp:'出かけるところだった。',kr:'막 나가려던 참이었다.'}
  ]},
  {pt:'~たばかり',m:'막 ~한',d:'직후',ex:[
    {jp:'今起きたばかりです。',kr:'방금 막 일어났습니다.'},
    {jp:'日本に来たばかりだ。',kr:'일본에 막 왔다.'}
  ]},
  {pt:'~はずだ',m:'~일 것이다',d:'당연한 추측',ex:[
    {jp:'彼はもう着いたはずです。',kr:'그는 이미 도착했을 겁니다.'},
    {jp:'知っているはずだ。',kr:'알고 있을 것이다.'}
  ]},
  {pt:'~とき',m:'~할 때',d:'시간',ex:[
    {jp:'日本に行ったとき、富士山を見ました。',kr:'일본에 갔을 때 후지산을 봤습니다.'},
    {jp:'暇なとき、遊びに来てください。',kr:'한가할 때 놀러 오세요.'}
  ]},
  {pt:'~たら',m:'~하면',d:'조건',ex:[
    {jp:'雨が降ったら行きません。',kr:'비가 오면 안 갑니다.'},
    {jp:'安かったら買います。',kr:'싸면 삽니다.'}
  ]},
  {pt:'~ば',m:'~하면',d:'조건(가정)',ex:[
    {jp:'時間があれば行きます。',kr:'시간이 있으면 갑니다.'},
    {jp:'早く寝れば大丈夫。',kr:'일찍 자면 괜찮아.'}
  ]},
  {pt:'~なら',m:'~라면',d:'조건(화제)',ex:[
    {jp:'日本語なら、少し分かります。',kr:'일본어라면 조금 압니다.'},
    {jp:'行くなら早く行って。',kr:'갈 거라면 빨리 가.'}
  ]},
  {pt:'~ように',m:'~하도록',d:'목적/바람',ex:[
    {jp:'忘れないように書いておきます。',kr:'잊지 않도록 적어둡니다.'},
    {jp:'聞こえるように大きい声で。',kr:'들리도록 큰 소리로.'}
  ]},
  {pt:'~ために',m:'~위해서',d:'목적',ex:[
    {jp:'試験に受かるために勉強する。',kr:'시험에 붙기 위해 공부한다.'},
    {jp:'健康のために運動しています。',kr:'건강을 위해 운동하고 있습니다.'}
  ]},
  {pt:'~し',m:'~하고, ~해서',d:'이유 나열',ex:[
    {jp:'この店は安いし、おいしいし、最高です。',kr:'이 가게는 싸고, 맛있고, 최고입니다.'},
    {jp:'時間もないし、お金もない。',kr:'시간도 없고, 돈도 없다.'}
  ]}
];


// ==================== N4 한자 (170자) ====================
const N4_KANJI = [
  // 동작 (1-20)
  {k:'開',o:'カイ',u:'あ(ける)',m:'열다',ex:'開ける(あける)열다'},
  {k:'閉',o:'ヘイ',u:'し(める)',m:'닫다',ex:'閉める(しめる)닫다'},
  {k:'始',o:'シ',u:'はじ(める)',m:'시작',ex:'始める(はじめる)시작하다'},
  {k:'終',o:'シュウ',u:'お(わる)',m:'끝',ex:'終わる(おわる)끝나다'},
  {k:'届',o:'とど(く)',u:'とど(ける)',m:'닿다',ex:'届く(とどく)도착하다'},
  {k:'会',o:'カイ',u:'あ(う)',m:'만나다',ex:'会う(あう)만나다'},
  {k:'別',o:'ベツ',u:'わか(れる)',m:'이별',ex:'別れる(わかれる)헤어지다'},
  {k:'運',o:'ウン',u:'はこ(ぶ)',m:'운반',ex:'運ぶ(はこぶ)옮기다'},
  {k:'持',o:'ジ',u:'も(つ)',m:'가지다',ex:'持つ(もつ)가지다'},
  {k:'待',o:'タイ',u:'ま(つ)',m:'기다리다',ex:'待つ(まつ)기다리다'},
  {k:'立',o:'リツ',u:'た(つ)',m:'서다',ex:'立つ(たつ)서다'},
  {k:'座',o:'ザ',u:'すわ(る)',m:'앉다',ex:'座る(すわる)앉다'},
  {k:'走',o:'ソウ',u:'はし(る)',m:'달리다',ex:'走る(はしる)달리다'},
  {k:'歩',o:'ホ',u:'ある(く)',m:'걷다',ex:'歩く(あるく)걷다'},
  {k:'止',o:'シ',u:'と(まる)',m:'멈추다',ex:'止まる(とまる)멈추다'},
  {k:'集',o:'シュウ',u:'あつ(まる)',m:'모이다',ex:'集まる(あつまる)모이다'},
  {k:'泣',o:'キュウ',u:'な(く)',m:'울다',ex:'泣く(なく)울다'},
  {k:'笑',o:'ショウ',u:'わら(う)',m:'웃다',ex:'笑う(わらう)웃다'},
  {k:'泳',o:'エイ',u:'およ(ぐ)',m:'수영',ex:'泳ぐ(およぐ)수영하다'},
  {k:'転',o:'テン',u:'ころ(ぶ)',m:'넘어지다',ex:'転ぶ(ころぶ)넘어지다'},
  // 감정/상태 (21-35)
  {k:'怒',o:'ド',u:'おこ(る)',m:'화나다',ex:'怒る(おこる)화내다'},
  {k:'困',o:'コン',u:'こま(る)',m:'곤란',ex:'困る(こまる)곤란하다'},
  {k:'疲',o:'ヒ',u:'つか(れる)',m:'피곤',ex:'疲れる(つかれる)피곤하다'},
  {k:'忙',o:'ボウ',u:'いそが(しい)',m:'바쁘다',ex:'忙しい(いそがしい)바쁘다'},
  {k:'暇',o:'カ',u:'ひま',m:'한가',ex:'暇(ひま)한가하다'},
  {k:'悲',o:'ヒ',u:'かな(しい)',m:'슬프다',ex:'悲しい(かなしい)슬프다'},
  {k:'嬉',o:'キ',u:'うれ(しい)',m:'기쁘다',ex:'嬉しい(うれしい)기쁘다'},
  {k:'寂',o:'セキ',u:'さび(しい)',m:'쓸쓸하다',ex:'寂しい(さびしい)쓸쓸하다'},
  {k:'恥',o:'チ',u:'は(ずかしい)',m:'부끄럽다',ex:'恥ずかしい(はずかしい)부끄럽다'},
  {k:'驚',o:'キョウ',u:'おどろ(く)',m:'놀라다',ex:'驚く(おどろく)놀라다'},
  // 생활/활동 (36-50)
  {k:'住',o:'ジュウ',u:'す(む)',m:'살다',ex:'住む(すむ)살다'},
  {k:'働',o:'ドウ',u:'はたら(く)',m:'일하다',ex:'働く(はたらく)일하다'},
  {k:'教',o:'キョウ',u:'おし(える)',m:'가르치다',ex:'教える(おしえる)가르치다'},
  {k:'習',o:'シュウ',u:'なら(う)',m:'배우다',ex:'習う(ならう)배우다'},
  {k:'勉',o:'ベン',u:'-',m:'힘쓰다',ex:'勉強(べんきょう)공부'},
  {k:'強',o:'キョウ',u:'つよ(い)',m:'강하다',ex:'強い(つよい)강하다'},
  {k:'研',o:'ケン',u:'-',m:'연구',ex:'研究(けんきゅう)연구'},
  {k:'究',o:'キュウ',u:'-',m:'탐구',ex:'研究(けんきゅう)연구'},
  {k:'験',o:'ケン',u:'-',m:'시험',ex:'試験(しけん)시험'},
  {k:'試',o:'シ',u:'ため(す)',m:'시도',ex:'試す(ためす)시험하다'},
  // 건물/장소 (51-70)
  {k:'館',o:'カン',u:'-',m:'관',ex:'図書館(としょかん)도서관'},
  {k:'堂',o:'ドウ',u:'-',m:'당',ex:'食堂(しょくどう)식당'},
  {k:'店',o:'テン',u:'みせ',m:'가게',ex:'店(みせ)가게'},
  {k:'院',o:'イン',u:'-',m:'원',ex:'病院(びょういん)병원'},
  {k:'社',o:'シャ',u:'-',m:'회사',ex:'会社(かいしゃ)회사'},
  {k:'場',o:'ジョウ',u:'ば',m:'장소',ex:'駐車場(ちゅうしゃじょう)주차장'},
  {k:'所',o:'ショ',u:'ところ',m:'곳',ex:'場所(ばしょ)장소'},
  {k:'室',o:'シツ',u:'-',m:'방',ex:'教室(きょうしつ)교실'},
  {k:'屋',o:'オク',u:'や',m:'집/가게',ex:'本屋(ほんや)서점'},
  {k:'庭',o:'テイ',u:'にわ',m:'정원',ex:'庭(にわ)정원'},
  {k:'橋',o:'キョウ',u:'はし',m:'다리',ex:'橋(はし)다리'},
  {k:'港',o:'コウ',u:'みなと',m:'항구',ex:'港(みなと)항구'},
  {k:'階',o:'カイ',u:'-',m:'층',ex:'二階(にかい)2층'},
  {k:'門',o:'モン',u:'かど',m:'문',ex:'門(もん)문'},
  // 자연 (71-85)
  {k:'林',o:'リン',u:'はやし',m:'숲',ex:'林(はやし)숲'},
  {k:'森',o:'シン',u:'もり',m:'숲',ex:'森(もり)숲'},
  {k:'池',o:'チ',u:'いけ',m:'연못',ex:'池(いけ)연못'},
  {k:'湖',o:'コ',u:'みずうみ',m:'호수',ex:'湖(みずうみ)호수'},
  {k:'島',o:'トウ',u:'しま',m:'섬',ex:'島(しま)섬'},
  {k:'岸',o:'ガン',u:'きし',m:'언덕',ex:'海岸(かいがん)해안'},
  {k:'坂',o:'ハン',u:'さか',m:'언덕',ex:'坂(さか)언덕'},
  {k:'谷',o:'コク',u:'たに',m:'골짜기',ex:'谷(たに)골짜기'},
  {k:'石',o:'セキ',u:'いし',m:'돌',ex:'石(いし)돌'},
  {k:'砂',o:'サ',u:'すな',m:'모래',ex:'砂(すな)모래'},
  // 신체 (86-100)
  {k:'頭',o:'トウ',u:'あたま',m:'머리',ex:'頭(あたま)머리'},
  {k:'顔',o:'ガン',u:'かお',m:'얼굴',ex:'顔(かお)얼굴'},
  {k:'首',o:'シュ',u:'くび',m:'목',ex:'首(くび)목'},
  {k:'肩',o:'ケン',u:'かた',m:'어깨',ex:'肩(かた)어깨'},
  {k:'背',o:'ハイ',u:'せ',m:'등',ex:'背中(せなか)등'},
  {k:'腕',o:'ワン',u:'うで',m:'팔',ex:'腕(うで)팔'},
  {k:'指',o:'シ',u:'ゆび',m:'손가락',ex:'指(ゆび)손가락'},
  {k:'足',o:'ソク',u:'あし',m:'발',ex:'足(あし)발'},
  {k:'心',o:'シン',u:'こころ',m:'마음',ex:'心(こころ)마음'},
  {k:'体',o:'タイ',u:'からだ',m:'몸',ex:'体(からだ)몸'},
  // 형용사 관련 (101-120)
  {k:'暗',o:'アン',u:'くら(い)',m:'어둡다',ex:'暗い(くらい)어둡다'},
  {k:'明',o:'メイ',u:'あか(るい)',m:'밝다',ex:'明るい(あかるい)밝다'},
  {k:'重',o:'ジュウ',u:'おも(い)',m:'무겁다',ex:'重い(おもい)무겁다'},
  {k:'軽',o:'ケイ',u:'かる(い)',m:'가볍다',ex:'軽い(かるい)가볍다'},
  {k:'太',o:'タイ',u:'ふと(い)',m:'굵다',ex:'太い(ふとい)굵다'},
  {k:'細',o:'サイ',u:'ほそ(い)',m:'가늘다',ex:'細い(ほそい)가늘다'},
  {k:'深',o:'シン',u:'ふか(い)',m:'깊다',ex:'深い(ふかい)깊다'},
  {k:'浅',o:'セン',u:'あさ(い)',m:'얕다',ex:'浅い(あさい)얕다'},
  {k:'広',o:'コウ',u:'ひろ(い)',m:'넓다',ex:'広い(ひろい)넓다'},
  {k:'狭',o:'キョウ',u:'せま(い)',m:'좁다',ex:'狭い(せまい)좁다'},
  {k:'速',o:'ソク',u:'はや(い)',m:'빠르다',ex:'速い(はやい)빠르다'},
  {k:'遅',o:'チ',u:'おそ(い)',m:'늦다',ex:'遅い(おそい)늦다'},
  {k:'固',o:'コ',u:'かた(い)',m:'단단하다',ex:'固い(かたい)단단하다'},
  {k:'柔',o:'ジュウ',u:'やわ(らかい)',m:'부드럽다',ex:'柔らかい(やわらかい)부드럽다'},
  {k:'若',o:'ジャク',u:'わか(い)',m:'젊다',ex:'若い(わかい)젊다'},
  {k:'老',o:'ロウ',u:'お(いる)',m:'늙다',ex:'老人(ろうじん)노인'},
  {k:'正',o:'セイ',u:'ただ(しい)',m:'올바르다',ex:'正しい(ただしい)올바르다'},
  {k:'美',o:'ビ',u:'うつく(しい)',m:'아름답다',ex:'美しい(うつくしい)아름답다'},
  {k:'珍',o:'チン',u:'めずら(しい)',m:'드물다',ex:'珍しい(めずらしい)드물다'},
  {k:'素',o:'ソ',u:'-',m:'소박하다',ex:'素晴らしい(すばらしい)훌륭하다'},
  // 시간/방향 (121-140)
  {k:'朝',o:'チョウ',u:'あさ',m:'아침',ex:'朝(あさ)아침'},
  {k:'昼',o:'チュウ',u:'ひる',m:'낮',ex:'昼(ひる)낮'},
  {k:'夕',o:'セキ',u:'ゆう',m:'저녁',ex:'夕方(ゆうがた)저녁'},
  {k:'夜',o:'ヤ',u:'よる',m:'밤',ex:'夜(よる)밤'},
  {k:'春',o:'シュン',u:'はる',m:'봄',ex:'春(はる)봄'},
  {k:'夏',o:'カ',u:'なつ',m:'여름',ex:'夏(なつ)여름'},
  {k:'秋',o:'シュウ',u:'あき',m:'가을',ex:'秋(あき)가을'},
  {k:'冬',o:'トウ',u:'ふゆ',m:'겨울',ex:'冬(ふゆ)겨울'},
  {k:'東',o:'トウ',u:'ひがし',m:'동쪽',ex:'東(ひがし)동쪽'},
  {k:'西',o:'セイ',u:'にし',m:'서쪽',ex:'西(にし)서쪽'},
  {k:'南',o:'ナン',u:'みなみ',m:'남쪽',ex:'南(みなみ)남쪽'},
  {k:'北',o:'ホク',u:'きた',m:'북쪽',ex:'北(きた)북쪽'},
  // 기타 동사 (141-160)
  {k:'送',o:'ソウ',u:'おく(る)',m:'보내다',ex:'送る(おくる)보내다'},
  {k:'帰',o:'キ',u:'かえ(る)',m:'돌아가다',ex:'帰る(かえる)돌아가다'},
  {k:'届',o:'トドケ',u:'とど(く)',m:'도착하다',ex:'届く(とどく)도착하다'},
  {k:'出',o:'シュツ',u:'で(る)',m:'나가다',ex:'出る(でる)나가다'},
  {k:'入',o:'ニュウ',u:'はい(る)',m:'들어가다',ex:'入る(はいる)들어가다'},
  {k:'起',o:'キ',u:'お(きる)',m:'일어나다',ex:'起きる(おきる)일어나다'},
  {k:'寝',o:'シン',u:'ね(る)',m:'자다',ex:'寝る(ねる)자다'},
  {k:'食',o:'ショク',u:'た(べる)',m:'먹다',ex:'食べる(たべる)먹다'},
  // 추가 (161-170)
  {k:'飲',o:'イン',u:'の(む)',m:'마시다',ex:'飲む(のむ)마시다'},
  {k:'作',o:'サク',u:'つく(る)',m:'만들다',ex:'作る(つくる)만들다'},
  {k:'買',o:'バイ',u:'か(う)',m:'사다',ex:'買う(かう)사다'},
  {k:'売',o:'バイ',u:'う(る)',m:'팔다',ex:'売る(うる)팔다'},
  {k:'貸',o:'タイ',u:'か(す)',m:'빌려주다',ex:'貸す(かす)빌려주다'},
  {k:'借',o:'シャク',u:'か(りる)',m:'빌리다',ex:'借りる(かりる)빌리다'},
  {k:'払',o:'フツ',u:'はら(う)',m:'지불하다',ex:'払う(はらう)지불하다'},
  {k:'比',o:'ヒ',u:'くら(べる)',m:'비교하다',ex:'比べる(くらべる)비교하다'},
  {k:'考',o:'コウ',u:'かんが(える)',m:'생각하다',ex:'考える(かんがえる)생각하다'},
  {k:'決',o:'ケツ',u:'き(める)',m:'정하다',ex:'決める(きめる)정하다'},
  // 추가 (125-170)
  {k:'見',o:'ケン',u:'み(る)',m:'보다',ex:'見る(みる)보다'},
  {k:'聞',o:'ブン',u:'き(く)',m:'듣다',ex:'聞く(きく)듣다'},
  {k:'話',o:'ワ',u:'はな(す)',m:'말하다',ex:'話す(はなす)말하다'},
  {k:'読',o:'ドク',u:'よ(む)',m:'읽다',ex:'読む(よむ)읽다'},
  {k:'書',o:'ショ',u:'か(く)',m:'쓰다',ex:'書く(かく)쓰다'},
  {k:'着',o:'チャク',u:'き(る)',m:'입다',ex:'着る(きる)입다'},
  {k:'脱',o:'ダツ',u:'ぬ(ぐ)',m:'벗다',ex:'脱ぐ(ぬぐ)벗다'},
  {k:'洗',o:'セン',u:'あら(う)',m:'씻다',ex:'洗う(あらう)씻다'},
  {k:'死',o:'シ',u:'し(ぬ)',m:'죽다',ex:'死ぬ(しぬ)죽다'},
  {k:'生',o:'セイ',u:'い(きる)',m:'살다',ex:'生きる(いきる)살다'},
  {k:'産',o:'サン',u:'う(まれる)',m:'태어나다',ex:'生まれる(うまれる)태어나다'},
  {k:'育',o:'イク',u:'そだ(てる)',m:'기르다',ex:'育てる(そだてる)기르다'},
  {k:'信',o:'シン',u:'しん(じる)',m:'믿다',ex:'信じる(しんじる)믿다'},
  {k:'定',o:'テイ',u:'き(まる)',m:'정해지다',ex:'決まる(きまる)정해지다'},
  {k:'変',o:'ヘン',u:'か(わる)',m:'변하다',ex:'変わる(かわる)변하다'},
  {k:'届',o:'カイ',u:'か(える)',m:'바꾸다',ex:'変える(かえる)바꾸다'},
  {k:'伝',o:'デン',u:'つた(える)',m:'전하다',ex:'伝える(つたえる)전하다'},
  {k:'直',o:'チョク',u:'なお(す)',m:'고치다',ex:'直す(なおす)고치다'},
  {k:'壊',o:'カイ',u:'こわ(れる)',m:'부서지다',ex:'壊れる(こわれる)부서지다'},
  {k:'落',o:'ラク',u:'お(ちる)',m:'떨어지다',ex:'落ちる(おちる)떨어지다'},
  {k:'上',o:'ジョウ',u:'あ(がる)',m:'오르다',ex:'上がる(あがる)오르다'},
  {k:'下',o:'カ',u:'さ(がる)',m:'내려가다',ex:'下がる(さがる)내려가다'},
  {k:'飛',o:'ヒ',u:'と(ぶ)',m:'날다',ex:'飛ぶ(とぶ)날다'},
  {k:'押',o:'オウ',u:'お(す)',m:'밀다',ex:'押す(おす)밀다'},
  {k:'引',o:'イン',u:'ひ(く)',m:'당기다',ex:'引く(ひく)당기다'},
  {k:'投',o:'トウ',u:'な(げる)',m:'던지다',ex:'投げる(なげる)던지다'},
  {k:'受',o:'ジュ',u:'う(ける)',m:'받다',ex:'受ける(うける)받다'},
  {k:'燃',o:'ネン',u:'も(える)',m:'타다',ex:'燃える(もえる)타다'},
  {k:'消',o:'ショウ',u:'き(える)',m:'꺼지다',ex:'消える(きえる)꺼지다'},
  {k:'光',o:'コウ',u:'ひか(る)',m:'빛나다',ex:'光る(ひかる)빛나다'},
  {k:'鳴',o:'メイ',u:'な(る)',m:'울리다',ex:'鳴る(なる)울리다'},
  {k:'匂',o:'シュウ',u:'にお(う)',m:'냄새나다',ex:'匂う(におう)냄새나다'},
  {k:'浴',o:'ヨク',u:'あ(びる)',m:'뒤집어쓰다',ex:'浴びる(あびる)샤워하다'},
  {k:'忘',o:'ボウ',u:'わす(れる)',m:'잊다',ex:'忘れる(わすれる)잊다'},
  {k:'覚',o:'カク',u:'おぼ(える)',m:'외우다',ex:'覚える(おぼえる)외우다'},
  {k:'知',o:'チ',u:'し(る)',m:'알다',ex:'知る(しる)알다'},
  {k:'分',o:'ブン',u:'わか(る)',m:'알다',ex:'分かる(わかる)알다'},
  {k:'感',o:'カン',u:'かん(じる)',m:'느끼다',ex:'感じる(かんじる)느끼다'},
  {k:'思',o:'シ',u:'おも(う)',m:'생각하다',ex:'思う(おもう)생각하다'},
  {k:'願',o:'ガン',u:'ねが(う)',m:'바라다',ex:'願う(ねがう)바라다'},
  {k:'祈',o:'キ',u:'いの(る)',m:'빌다',ex:'祈る(いのる)빌다'},
  {k:'頼',o:'ライ',u:'たの(む)',m:'부탁하다',ex:'頼む(たのむ)부탁하다'},
  {k:'答',o:'トウ',u:'こた(える)',m:'대답하다',ex:'答える(こたえる)대답하다'},
  {k:'呼',o:'コ',u:'よ(ぶ)',m:'부르다',ex:'呼ぶ(よぶ)부르다'},
  {k:'探',o:'タン',u:'さが(す)',m:'찾다',ex:'探す(さがす)찾다'}
];


// ==================== N4 문법 ====================
const N4_GRAMMAR = [
  {pt:'~える/~られる (가능)',m:'~할 수 있다',d:'가능형 (5단→える, 1단→られる)',ex:[
    {jp:'日本語が話せます。',kr:'일본어를 할 수 있습니다.'},
    {jp:'この料理が食べられる。',kr:'이 요리를 먹을 수 있다.'}
  ]},
  {pt:'~させる',m:'~시키다',d:'사역형',ex:[
    {jp:'子供に宿題をさせる。',kr:'아이에게 숙제를 시킨다.'},
    {jp:'部下を帰らせました。',kr:'부하를 돌려보냈습니다.'}
  ]},
  {pt:'~(ら)れる (수동)',m:'~되다, ~당하다',d:'수동형',ex:[
    {jp:'先生に褒められた。',kr:'선생님께 칭찬받았다.'},
    {jp:'雨に降られた。',kr:'비를 맞았다.'}
  ]},
  {pt:'~そうだ (양태)',m:'~할 것 같다',d:'외관 추측',ex:[
    {jp:'雨が降りそうです。',kr:'비가 올 것 같습니다.'},
    {jp:'このケーキはおいしそう。',kr:'이 케이크는 맛있어 보인다.'}
  ]},
  {pt:'~そうだ (전문)',m:'~라고 한다',d:'전해들은 정보',ex:[
    {jp:'明日は晴れるそうです。',kr:'내일은 맑다고 합니다.'},
    {jp:'彼は来月結婚するそうだ。',kr:'그는 다음 달 결혼한다고 한다.'}
  ]},
  {pt:'~ようだ/みたいだ',m:'~인 것 같다',d:'추측',ex:[
    {jp:'彼は忙しいようです。',kr:'그는 바쁜 것 같습니다.'},
    {jp:'風邪を引いたみたいだ。',kr:'감기 걸린 것 같다.'}
  ]},
  {pt:'~ようにする',m:'~하도록 하다',d:'노력/습관',ex:[
    {jp:'毎日運動するようにしています。',kr:'매일 운동하도록 하고 있습니다.'},
    {jp:'早く寝るようにしよう。',kr:'일찍 자도록 하자.'}
  ]},
  {pt:'~ようになる',m:'~하게 되다',d:'변화/상태 변화',ex:[
    {jp:'日本語が話せるようになりました。',kr:'일본어를 할 수 있게 되었습니다.'},
    {jp:'野菜が食べられるようになった。',kr:'야채를 먹을 수 있게 되었다.'}
  ]},
  {pt:'~てしまう',m:'~해 버리다',d:'완료/유감',ex:[
    {jp:'電車に乗り遅れてしまった。',kr:'전철을 놓쳐 버렸다.'},
    {jp:'全部食べてしまいました。',kr:'전부 먹어 버렸습니다.'}
  ]},
  {pt:'~ておく',m:'~해 두다',d:'준비/방치',ex:[
    {jp:'ホテルを予約しておきます。',kr:'호텔을 예약해 둡니다.'},
    {jp:'窓を開けておいてください。',kr:'창문을 열어 두세요.'}
  ]},
  {pt:'~てある',m:'~해져 있다',d:'결과 상태',ex:[
    {jp:'窓が開けてあります。',kr:'창문이 열려져 있습니다.'},
    {jp:'名前が書いてある。',kr:'이름이 쓰여져 있다.'}
  ]},
  {pt:'~ば/~たら',m:'~하면',d:'조건',ex:[
    {jp:'時間があれば行きます。',kr:'시간이 있으면 갑니다.'},
    {jp:'安かったら買います。',kr:'싸면 삽니다.'}
  ]},
  {pt:'~のに',m:'~인데도',d:'역접',ex:[
    {jp:'約束したのに来なかった。',kr:'약속했는데도 오지 않았다.'},
    {jp:'高いのに買った。',kr:'비싼데도 샀다.'}
  ]},
  {pt:'~ために',m:'~위해서',d:'목적/원인',ex:[
    {jp:'試験に受かるために勉強する。',kr:'시험에 붙기 위해 공부한다.'},
    {jp:'雨のために中止になった。',kr:'비 때문에 중지되었다.'}
  ]},
  {pt:'~はずだ',m:'~할 것이다, ~일 터이다',d:'당연한 추측',ex:[
    {jp:'彼はもう着いたはずです。',kr:'그는 이미 도착했을 것입니다.'},
    {jp:'このぐらいなら分かるはずだ。',kr:'이 정도라면 알 것이다.'}
  ]},
  {pt:'~ことがある',m:'~한 적이 있다',d:'경험',ex:[
    {jp:'日本に行ったことがあります。',kr:'일본에 간 적이 있습니다.'},
    {jp:'この映画を見たことがない。',kr:'이 영화를 본 적이 없다.'}
  ]},
  {pt:'~ことにする',m:'~하기로 하다',d:'결정',ex:[
    {jp:'来月から運動することにしました。',kr:'다음 달부터 운동하기로 했습니다.'},
    {jp:'今日は早く寝ることにする。',kr:'오늘은 일찍 자기로 한다.'}
  ]},
  {pt:'~ことになる',m:'~하게 되다',d:'결정(외부)',ex:[
    {jp:'来月転勤することになりました。',kr:'다음 달 전근하게 되었습니다.'},
    {jp:'会議は中止になることになった。',kr:'회의는 중지되기로 되었다.'}
  ]},
  {pt:'~てみる',m:'~해 보다',d:'시도',ex:[
    {jp:'この料理を食べてみてください。',kr:'이 요리를 먹어 보세요.'},
    {jp:'一度やってみます。',kr:'한번 해 보겠습니다.'}
  ]},
  {pt:'~てくる',m:'~해 오다',d:'방향/변화',ex:[
    {jp:'だんだん暖かくなってきました。',kr:'점점 따뜻해져 왔습니다.'},
    {jp:'買い物に行ってきます。',kr:'쇼핑 다녀오겠습니다.'}
  ]},
  {pt:'~ていく',m:'~해 가다',d:'방향/변화',ex:[
    {jp:'これからも頑張っていきます。',kr:'앞으로도 열심히 해 가겠습니다.'},
    {jp:'人口が減っていく。',kr:'인구가 줄어 간다.'}
  ]},
  {pt:'~たがる',m:'~하고 싶어하다',d:'제3자 희망',ex:[
    {jp:'子供はお菓子を食べたがる。',kr:'아이는 과자를 먹고 싶어한다.'},
    {jp:'彼女は日本に行きたがっている。',kr:'그녀는 일본에 가고 싶어한다.'}
  ]},
  {pt:'~がる',m:'~해하다',d:'제3자 감정',ex:[
    {jp:'彼は寒がっている。',kr:'그는 추워한다.'},
    {jp:'子供が怖がっています。',kr:'아이가 무서워하고 있습니다.'}
  ]},
  {pt:'~すぎる',m:'너무 ~하다',d:'과도',ex:[
    {jp:'食べすぎました。',kr:'너무 많이 먹었습니다.'},
    {jp:'この部屋は暑すぎる。',kr:'이 방은 너무 덥다.'}
  ]},
  {pt:'~やすい/にくい',m:'~하기 쉽다/어렵다',d:'난이도',ex:[
    {jp:'この本は読みやすいです。',kr:'이 책은 읽기 쉽습니다.'},
    {jp:'この漢字は覚えにくい。',kr:'이 한자는 외우기 어렵다.'}
  ]},
  {pt:'~始める/終わる',m:'~하기 시작하다/끝나다',d:'동작 시작/종료',ex:[
    {jp:'雨が降り始めました。',kr:'비가 내리기 시작했습니다.'},
    {jp:'やっと読み終わった。',kr:'드디어 다 읽었다.'}
  ]},
  {pt:'~続ける',m:'계속 ~하다',d:'동작 계속',ex:[
    {jp:'5時間歩き続けました。',kr:'5시간 계속 걸었습니다.'},
    {jp:'勉強を続けてください。',kr:'공부를 계속하세요.'}
  ]},
  {pt:'~出す',m:'~하기 시작하다',d:'동작 시작(갑자기)',ex:[
    {jp:'急に泣き出した。',kr:'갑자기 울기 시작했다.'},
    {jp:'彼女は走り出しました。',kr:'그녀는 달리기 시작했습니다.'}
  ]},
  {pt:'~ながら',m:'~하면서',d:'동시 동작',ex:[
    {jp:'音楽を聞きながら勉強する。',kr:'음악을 들으면서 공부한다.'},
    {jp:'歩きながら話しましょう。',kr:'걸으면서 이야기합시다.'}
  ]},
  {pt:'~たり~たりする',m:'~하거나 ~하거나 하다',d:'동작 나열',ex:[
    {jp:'休みの日は本を読んだり映画を見たりします。',kr:'쉬는 날은 책을 읽거나 영화를 보거나 합니다.'},
    {jp:'行ったり来たりしている。',kr:'왔다 갔다 하고 있다.'}
  ]},
  {pt:'~ても',m:'~해도',d:'역접 조건',ex:[
    {jp:'雨が降っても行きます。',kr:'비가 와도 갑니다.'},
    {jp:'高くても買います。',kr:'비싸도 삽니다.'}
  ]},
  {pt:'~なくても',m:'~하지 않아도',d:'부정 양보',ex:[
    {jp:'無理しなくてもいいですよ。',kr:'무리하지 않아도 돼요.'},
    {jp:'来なくてもいい。',kr:'오지 않아도 된다.'}
  ]},
  {pt:'~なければならない',m:'~해야 한다',d:'의무',ex:[
    {jp:'宿題をしなければなりません。',kr:'숙제를 해야 합니다.'},
    {jp:'明日早く起きなければならない。',kr:'내일 일찍 일어나야 한다.'}
  ]},
  {pt:'~なくてはいけない',m:'~해야 한다',d:'의무',ex:[
    {jp:'薬を飲まなくてはいけません。',kr:'약을 먹어야 합니다.'},
    {jp:'もっと練習しなくてはいけない。',kr:'더 연습해야 한다.'}
  ]},
  {pt:'~てもいい',m:'~해도 된다',d:'허가',ex:[
    {jp:'ここに座ってもいいですか。',kr:'여기 앉아도 될까요?'},
    {jp:'帰ってもいいよ。',kr:'가도 돼.'}
  ]},
  {pt:'~てはいけない',m:'~하면 안 된다',d:'금지',ex:[
    {jp:'ここで写真を撮ってはいけません。',kr:'여기서 사진을 찍으면 안 됩니다.'},
    {jp:'嘘をついてはいけない。',kr:'거짓말을 하면 안 된다.'}
  ]},
  {pt:'~ないで',m:'~하지 않고',d:'부정 상태',ex:[
    {jp:'朝ご飯を食べないで出かけた。',kr:'아침을 먹지 않고 외출했다.'},
    {jp:'辞書を見ないで書いてください。',kr:'사전을 보지 않고 써 주세요.'}
  ]},
  {pt:'~ずに',m:'~하지 않고',d:'부정 상태(문어)',ex:[
    {jp:'何も言わずに帰った。',kr:'아무 말도 하지 않고 돌아갔다.'},
    {jp:'休まずに働いた。',kr:'쉬지 않고 일했다.'}
  ]},
  {pt:'~ように言う',m:'~하라고 말하다',d:'간접 명령',ex:[
    {jp:'医者に運動するように言われました。',kr:'의사에게 운동하라고 들었습니다.'},
    {jp:'早く来るように言ってください。',kr:'빨리 오라고 말해 주세요.'}
  ]},
  {pt:'~と言っていた',m:'~라고 말했다',d:'전달',ex:[
    {jp:'彼は来ないと言っていました。',kr:'그는 안 온다고 말했습니다.'},
    {jp:'明日は暇だと言っていた。',kr:'내일은 한가하다고 했다.'}
  ]},
  {pt:'~かどうか',m:'~인지 아닌지',d:'의문 포함',ex:[
    {jp:'行くかどうか分かりません。',kr:'갈지 안 갈지 모르겠습니다.'},
    {jp:'本当かどうか確認してください。',kr:'진짜인지 아닌지 확인해 주세요.'}
  ]},
  {pt:'~という',m:'~라는',d:'명칭/설명',ex:[
    {jp:'富士山という山を知っていますか。',kr:'후지산이라는 산을 아세요?'},
    {jp:'これは何という花ですか。',kr:'이것은 뭐라는 꽃이에요?'}
  ]},
  {pt:'~ばかり',m:'~뿐, ~만',d:'한정/직후',ex:[
    {jp:'ゲームばかりしている。',kr:'게임만 하고 있다.'},
    {jp:'今来たばかりです。',kr:'지금 막 왔습니다.'}
  ]},
  {pt:'~だけ',m:'~만, ~뿐',d:'한정',ex:[
    {jp:'一人だけ残っている。',kr:'한 사람만 남아 있다.'},
    {jp:'これだけでいいです。',kr:'이것만으로 됩니다.'}
  ]},
  {pt:'~しか~ない',m:'~밖에 ~없다',d:'한정(부정)',ex:[
    {jp:'1000円しかありません。',kr:'1000엔밖에 없습니다.'},
    {jp:'彼にしかできない。',kr:'그에게밖에 못한다.'}
  ]},
  {pt:'~さえ~ば',m:'~만 ~하면',d:'조건 최소',ex:[
    {jp:'お金さえあれば買えます。',kr:'돈만 있으면 살 수 있습니다.'},
    {jp:'薬を飲みさえすれば治る。',kr:'약만 먹으면 낫는다.'}
  ]},
  {pt:'~まで',m:'~까지',d:'범위 극단',ex:[
    {jp:'子供まで知っている。',kr:'아이까지 알고 있다.'},
    {jp:'そこまでする必要はない。',kr:'거기까지 할 필요는 없다.'}
  ]},
  {pt:'~について',m:'~에 대해서',d:'주제',ex:[
    {jp:'日本の文化について調べています。',kr:'일본 문화에 대해서 조사하고 있습니다.'},
    {jp:'この問題について話し合いましょう。',kr:'이 문제에 대해서 이야기합시다.'}
  ]},
  {pt:'~によると',m:'~에 의하면',d:'정보 출처',ex:[
    {jp:'天気予報によると明日は雨です。',kr:'일기예보에 의하면 내일은 비입니다.'},
    {jp:'彼の話によると本当らしい。',kr:'그의 말에 의하면 사실인 것 같다.'}
  ]},
  {pt:'~によって',m:'~에 따라, ~에 의해',d:'수단/원인',ex:[
    {jp:'人によって意見が違います。',kr:'사람에 따라 의견이 다릅니다.'},
    {jp:'この本は有名な作家によって書かれた。',kr:'이 책은 유명한 작가에 의해 쓰여졌다.'}
  ]},
  {pt:'~として',m:'~로서',d:'자격/입장',ex:[
    {jp:'留学生として日本に来ました。',kr:'유학생으로서 일본에 왔습니다.'},
    {jp:'先輩として助言します。',kr:'선배로서 조언합니다.'}
  ]},
  {pt:'~とおり',m:'~대로',d:'방식',ex:[
    {jp:'言われたとおりにしました。',kr:'말한 대로 했습니다.'},
    {jp:'予定どおり出発します。',kr:'예정대로 출발합니다.'}
  ]},
  {pt:'~ておける',m:'~해 둘 수 있다',d:'준비 가능',ex:[
    {jp:'冷蔵庫に入れておけます。',kr:'냉장고에 넣어 둘 수 있습니다.'},
    {jp:'先に言っておける。',kr:'먼저 말해 둘 수 있다.'}
  ]},
  {pt:'~わけだ',m:'~인 셈이다, 당연히',d:'논리적 귀결',ex:[
    {jp:'だから失敗したわけだ。',kr:'그래서 실패한 거구나.'},
    {jp:'忙しいわけですね。',kr:'바쁠 수밖에요.'}
  ]},
  {pt:'~わけではない',m:'~인 것은 아니다',d:'부분 부정',ex:[
    {jp:'嫌いなわけではありません。',kr:'싫은 건 아닙니다.'},
    {jp:'全部分かるわけではない。',kr:'전부 아는 건 아니다.'}
  ]},
  {pt:'~わけにはいかない',m:'~할 수 없다',d:'불가(사정)',ex:[
    {jp:'約束があるから遅れるわけにはいかない。',kr:'약속이 있어서 늦을 수 없다.'},
    {jp:'ここで諦めるわけにはいかない。',kr:'여기서 포기할 수 없다.'}
  ]},
  {pt:'~ところ',m:'~하는 중/직전/직후',d:'시점',ex:[
    {jp:'今、食べているところです。',kr:'지금 먹고 있는 중입니다.'},
    {jp:'出かけるところでした。',kr:'막 나가려던 참이었습니다.'}
  ]},
  {pt:'~最中',m:'~하는 한창',d:'진행 중',ex:[
    {jp:'会議の最中に電話が鳴った。',kr:'회의 도중에 전화가 울렸다.'},
    {jp:'食事の最中です。',kr:'식사 중입니다.'}
  ]},
  {pt:'~たとたん',m:'~하자마자',d:'직후',ex:[
    {jp:'ドアを開けたとたん、猫が逃げた。',kr:'문을 열자마자 고양이가 도망갔다.'},
    {jp:'起きたとたんに電話が鳴った。',kr:'일어나자마자 전화가 울렸다.'}
  ]},
  {pt:'~次第',m:'~하는 대로',d:'직후 조건',ex:[
    {jp:'届き次第連絡します。',kr:'도착하는 대로 연락하겠습니다.'},
    {jp:'分かり次第お知らせください。',kr:'알게 되는 대로 알려주세요.'}
  ]},
  {pt:'~ほど',m:'~만큼, ~정도',d:'정도',ex:[
    {jp:'死ぬほど疲れた。',kr:'죽을 만큼 피곤했다.'},
    {jp:'彼ほど上手じゃない。',kr:'그만큼 잘하지 못한다.'}
  ]}
];


// ==================== 렌더링 ====================
function render() {
  const app = document.getElementById('app');
  const levelColor = state.level === 'n5' ? '#10b981' : '#f59e0b';
  
  const loginHtml = firebaseUser ? `
    <div class="dropdown">
      <button class="user-info" onclick="toggleUserMenu()" style="background:none;border:none;cursor:pointer;">
        <img src="${firebaseUser.photoURL || ''}" class="user-avatar" onerror="this.style.display='none'">
        <span class="user-name">${firebaseUser.displayName?.split(' ')[0] || ''}</span>
        <span class="sync-icon">${syncStatus === 'synced' ? '✓' : '⟳'}</span>
      </button>
      <div class="dropdown-menu" id="userDropdown">
        <div class="dropdown-item" onclick="syncNow()">🔄 동기화</div>
        <div class="dropdown-item" onclick="handleLogout()">🚪 로그아웃</div>
      </div>
    </div>
  ` : `<button class="login-btn" onclick="handleLogin()">🔐 로그인</button>`;
  
  app.innerHTML = `
    <header>
      <div class="header-top">
        <div style="display:flex;align-items:center;gap:0.5rem;">
          <a href="index.html" style="background:rgba(255,255,255,0.2);border:none;padding:0.4rem 0.6rem;border-radius:0.5rem;color:white;text-decoration:none;font-size:1rem;">🏠</a>
          <span class="header-title">🎯 JLPT ${state.level.toUpperCase()} 마스터</span>
        </div>
        <div class="header-controls">
          ${loginHtml}
          <select onchange="switchProfile(this.value)">
            ${profiles.map(p => `<option value="${p}" ${p===currentProfile?'selected':''}>${p}</option>`).join('')}
          </select>
          <button onclick="addProfile()" title="프로필 추가">➕</button>
        </div>
      </div>
      <div class="level-tabs">
        <button class="level-tab n5 ${state.level==='n5'?'active':''}" onclick="setLevel('n5')">📗 N5 초급</button>
        <button class="level-tab n4 ${state.level==='n4'?'active':''}" onclick="setLevel('n4')">📙 N4 초중급</button>
      </div>
    </header>
    <nav class="nav">
      <button class="nav-btn ${state.section==='kanji'?'active':''}" onclick="setSection('kanji')">📚 한자</button>
      <button class="nav-btn ${state.section==='vocab'?'active':''}" onclick="setSection('vocab')">💬 어휘</button>
      <button class="nav-btn ${state.section==='grammar'?'active':''}" onclick="setSection('grammar')">📝 문법</button>
      <button class="nav-btn ${state.section==='quiz'?'active':''}" onclick="setSection('quiz')">✏️ 퀴즈</button>
    </nav>
    <main>
      ${renderSection()}
    </main>
  `;
  
  // 하단 네비게이션 active 상태 업데이트
  document.getElementById('navN5').classList.toggle('active', state.level === 'n5');
  document.getElementById('navN4').classList.toggle('active', state.level === 'n4');
}

function setLevel(level) {
  state.level = level;
  state.subSection = 'all';
  state.page = 1;
  render();
}

function setSection(section) {
  state.section = section;
  state.subSection = 'all';
  state.page = 1;
  state.quizMode = false;
  render();
}


function renderSection() {
  switch(state.section) {
    case 'kanji': return renderKanji();
    case 'vocab': return renderVocab();
    case 'grammar': return renderGrammar();
    case 'quiz': return renderQuiz();
    default: return '';
  }
}

// ========== 한자 섹션 ==========
function renderKanji() {
  const data = state.level === 'n5' ? N5_KANJI : N4_KANJI;
  const learned = progress[state.level].kanji || [];
  
  return `
    <div class="card">
      <div class="card-title" style="display:flex;justify-content:space-between;align-items:center;">
        <span>📚 ${state.level.toUpperCase()} 한자 (${data.length}자)</span>
        ${learned.length > 0 ? `<button class="btn btn-sm btn-gray" onclick="resetSection('${state.level}','kanji')">🔄 리셋</button>` : ''}
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${(learned.length/data.length*100).toFixed(1)}%"></div></div>
      <div class="text-xs text-gray" style="margin-top:0.25rem">${learned.length}/${data.length} 학습완료</div>
    </div>
    <div class="card" style="background:#f0f9ff;font-size:0.8rem;padding:0.75rem">
      <div style="font-weight:bold;margin-bottom:0.5rem">📖 한자 읽기 가이드</div>
      <div style="color:#374151;line-height:1.7">
        <span style="color:#dc2626;font-weight:bold">음독(音読み)</span>: 중국에서 온 읽기. 한자끼리 붙을 때 주로 사용<br>
        &nbsp;&nbsp;예) 山+川 → 山川(さん<u>せん</u>) 산천<br>
        <span style="color:#2563eb;font-weight:bold">훈독(訓読み)</span>: 일본 고유 읽기. 한자 혼자 or 히라가나 붙을 때<br>
        &nbsp;&nbsp;예) 山 → やま, 山登り(やまのぼり) 등산<br><br>
        ⚠️ <strong>같은 한자도 단어마다 읽기가 달라요!</strong><br>
        &nbsp;&nbsp;今(いま)지금 / 今日(きょう)오늘 / 今週(こんしゅう)이번주<br>
        &nbsp;&nbsp;→ <strong>단어째로 외우는 게 중요!</strong><br><br>
        🔊 음독 &nbsp;│&nbsp; 🔉 훈독 &nbsp;│&nbsp; 📖 예문 &nbsp;│&nbsp; ✓ 학습완료
      </div>
    </div>
    <div class="card" style="background:#fef3c7;font-size:0.8rem;padding:0.75rem">
      <div style="font-weight:bold;margin-bottom:0.5rem">💡 JLPT 시험 팁</div>
      <div style="color:#92400e;line-height:1.7">
        JLPT에서는 <strong>한자 읽기 문제</strong>가 자주 나와요!<br>
        📖 버튼으로 <strong>예문 발음</strong>을 들으면서 통째로 익히세요.<br>
        한자 하나씩 외우는 것보다 <strong>예문 단위로 반복</strong>하는 게 효과적!
      </div>
    </div>
    <div class="grid-2">
      ${data.slice((state.page-1)*ITEMS_PER_PAGE, state.page*ITEMS_PER_PAGE).map((item, idx) => {
        const i = (state.page-1)*ITEMS_PER_PAGE + idx;
        return `
        <div class="kanji-card" data-kanji="${item.k}" style="${learned.includes(i)?'opacity:0.6;background:#f0fdf4':''}" title="더블클릭으로 단어장 추가">
          <div class="kanji-char">${item.k}</div>
          <div class="kanji-reading">
            <span style="color:#dc2626">음: ${item.o} <span style="font-size:0.65rem;color:#888">${toRomaji(item.o)}</span></span>
            <span style="color:#2563eb">훈: ${item.u} <span style="font-size:0.65rem;color:#888">${toRomaji(item.u)}</span></span>
          </div>
          <div class="kanji-meaning">${item.m}</div>
          <div class="kanji-example">${item.ex}</div>
          <div style="display:flex;gap:0.25rem;margin-top:0.5rem">
            <button class="btn-sound" onclick="speak('${item.o}')" title="음독">🔊</button>
            <button class="btn-sound" onclick="speak('${item.u.replace(/[\(\)]/g,'')}')" title="훈독">🔉</button>
            <button class="btn-sound" onclick="speak('${item.ex.split('(')[0]}')" title="예문">📖</button>
            ${!learned.includes(i)?`<button class="btn-sound" onclick="markLearned('${state.level}','kanji',${i});render()">✓</button>`:''}
          </div>
        </div>`;
      }).join('')}
    </div>
    ${renderPagination(data.length)}
  `;
}


// ========== 어휘 섹션 ==========
function renderVocab() {
  const data = state.level === 'n5' ? N5_VOCAB : N4_VOCAB;
  const categories = Object.keys(data);
  const currentCat = state.subSection === 'all' ? categories[0] : state.subSection;
  const items = data[currentCat]?.items || [];
  
  return `
    <div class="sub-tabs">
      ${categories.map(cat => `
        <button class="sub-tab ${currentCat===cat?'active':''}" onclick="state.subSection='${cat}';render()">
          ${data[cat].name}
        </button>
      `).join('')}
    </div>
    <div class="card">
      <div class="card-title">💬 ${data[currentCat]?.name || ''} (${items.length}개)</div>
      <button class="btn btn-primary btn-sm" onclick="playAllVocab('${currentCat}')" style="margin-bottom:0.75rem">🔊 전체 듣기</button>
    </div>
    ${items.map((item, i) => `
      <div class="vocab-card" data-jp="${item.jp}" style="margin-bottom:0.5rem" title="더블클릭으로 단어장 추가">
        <div>
          <div class="vocab-jp">${item.jp}${item.n?` (${item.n})`:''} <span style="font-size:0.7rem;color:#888">${toRomaji(item.jp)}</span></div>
          <div class="vocab-kr">${item.kr}</div>
        </div>
        <button class="btn-sound" onclick="speak('${item.jp}')">🔊</button>
      </div>
    `).join('')}
  `;
}

let playingAll = false;
async function playAllVocab(cat) {
  const data = state.level === 'n5' ? N5_VOCAB : N4_VOCAB;
  const items = data[cat]?.items || [];
  playingAll = true;
  for (let i = 0; i < items.length && playingAll; i++) {
    speak(items[i].jp, 0.7);
    await new Promise(r => setTimeout(r, 2000));
  }
}


// ========== 문법 섹션 ==========
function renderGrammar() {
  const data = state.level === 'n5' ? N5_GRAMMAR : N4_GRAMMAR;
  const pageData = data.slice((state.page-1)*ITEMS_PER_PAGE, state.page*ITEMS_PER_PAGE);
  
  return `
    <div class="card">
      <div class="card-title">📝 ${state.level.toUpperCase()} 문법 (${data.length}개)</div>
    </div>
    ${pageData.map((g, i) => `
      <div class="grammar-card" data-pattern="${g.pt}" title="더블클릭으로 단어장 추가">
        <div class="grammar-pattern">${g.pt} <span style="font-size:0.75rem;color:#888">${toRomaji(g.pt)}</span></div>
        <div class="grammar-meaning"><strong>${g.m}</strong> - ${g.d}</div>
        ${g.ex.map(e => `
          <div class="grammar-example">
            <div class="grammar-jp">
              ${e.jp}
              <button class="btn-sound" onclick="speak('${e.jp.replace(/'/g,"\\'")}')">🔊</button>
            </div>
            <div class="grammar-kr">${e.kr}</div>
          </div>
        `).join('')}
      </div>
    `).join('')}
    ${renderPagination(data.length)}
  `;
}

// ========== 퀴즈 섹션 ==========
let quizState = { type: 'kanji', questions: [], current: 0, score: 0, answered: false, selected: null };

function resetQuiz() {
  quizState = { type: 'kanji', questions: [], current: 0, score: 0, answered: false, selected: null };
  render();
}

function renderQuiz() {
  if (!quizState.questions.length || quizState.current >= quizState.questions.length) {
    return `
      <div class="card text-center">
        <div class="card-title">✏️ 퀴즈 선택</div>
        <p class="text-sm text-gray mb-3">학습한 내용을 테스트해보세요!</p>
        <div class="grid-2">
          <button class="btn btn-primary" onclick="startQuiz('kanji')">📚 한자 읽기</button>
          <button class="btn btn-green" onclick="startQuiz('vocab')">💬 어휘 뜻</button>
          <button class="btn btn-orange" onclick="startQuiz('grammar')">📝 문법</button>
          <button class="btn btn-gray" onclick="startQuiz('listening')">🎧 청해</button>
        </div>
        ${quizState.score > 0 ? `
          <div style="margin-top:1rem;padding:1rem;background:#f0fdf4;border-radius:0.5rem">
            <div class="font-bold">이전 결과: ${quizState.score}점</div>
          </div>
        ` : ''}
      </div>
    `;
  }
  
  const q = quizState.questions[quizState.current];
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
        <div class="text-sm text-gray">${quizState.current + 1} / ${quizState.questions.length}</div>
        <button class="btn btn-sm btn-gray" onclick="resetQuiz()">✕ 그만두기</button>
      </div>
      <div class="progress-bar mb-3"><div class="progress-fill" style="width:${((quizState.current)/quizState.questions.length*100)}%"></div></div>
      <div class="text-center" style="font-size:2.5rem;margin:1.5rem 0">${q.question}</div>
      ${quizState.type === 'listening' ? `<button class="btn btn-primary" onclick="speak('${q.question}')" style="margin:0 auto;display:block">🔊 다시 듣기</button>` : ''}
    </div>
    <div>
      ${q.options.map((opt, i) => `
        <button class="quiz-option ${quizState.answered ? (i === q.correct ? 'correct' : (quizState.selected === i ? 'wrong' : '')) : ''}"
          onclick="answerQuiz(${i})" ${quizState.answered ? 'disabled' : ''}>
          ${opt}
        </button>
      `).join('')}
    </div>
    ${quizState.answered ? `
      <button class="btn btn-primary" onclick="nextQuestion()" style="width:100%;margin-top:1rem">
        ${quizState.current + 1 >= quizState.questions.length ? '결과 보기' : '다음 문제'} →
      </button>
    ` : ''}
  `;
}


function startQuiz(type) {
  quizState = { type, questions: [], current: 0, score: 0, answered: false, selected: null };
  let source = [];
  
  if (type === 'kanji') {
    source = state.level === 'n5' ? N5_KANJI : N4_KANJI;
    quizState.questions = shuffle(source).slice(0, 10).map(k => ({
      question: k.k,
      options: shuffle([k.o, ...getRandomItems(source.filter(x=>x.k!==k.k), 3).map(x=>x.o)]),
      correct: 0
    })).map(q => ({...q, correct: q.options.indexOf(q.options[0]), options: shuffle(q.options)}));
    quizState.questions.forEach(q => q.correct = q.options.indexOf(source.find(k=>k.k===q.question).o));
  } else if (type === 'vocab') {
    const vocabData = state.level === 'n5' ? N5_VOCAB : N4_VOCAB;
    Object.values(vocabData).forEach(cat => source.push(...cat.items));
    quizState.questions = shuffle(source).slice(0, 10).map(v => ({
      question: v.jp,
      options: shuffle([v.kr, ...getRandomItems(source.filter(x=>x.jp!==v.jp), 3).map(x=>x.kr)]),
      correct: 0
    }));
    quizState.questions.forEach(q => q.correct = q.options.indexOf(source.find(v=>v.jp===q.question).kr));
  } else if (type === 'grammar') {
    source = state.level === 'n5' ? N5_GRAMMAR : N4_GRAMMAR;
    quizState.questions = shuffle(source).slice(0, 10).map(g => ({
      question: g.pt,
      options: shuffle([g.m, ...getRandomItems(source.filter(x=>x.pt!==g.pt), 3).map(x=>x.m)]),
      correct: 0
    }));
    quizState.questions.forEach(q => q.correct = q.options.indexOf(source.find(g=>g.pt===q.question).m));
  } else if (type === 'listening') {
    const vocabData = state.level === 'n5' ? N5_VOCAB : N4_VOCAB;
    Object.values(vocabData).forEach(cat => source.push(...cat.items));
    quizState.questions = shuffle(source).slice(0, 10).map(v => ({
      question: v.jp,
      options: shuffle([v.kr, ...getRandomItems(source.filter(x=>x.jp!==v.jp), 3).map(x=>x.kr)]),
      correct: 0
    }));
    quizState.questions.forEach(q => q.correct = q.options.indexOf(source.find(v=>v.jp===q.question).kr));
    setTimeout(() => speak(quizState.questions[0].question), 500);
  }
  
  render();
}

function answerQuiz(idx) {
  if (quizState.answered) return;
  quizState.answered = true;
  quizState.selected = idx;
  if (idx === quizState.questions[quizState.current].correct) {
    quizState.score += 10;
  }
  render();
}

function nextQuestion() {
  quizState.current++;
  quizState.answered = false;
  quizState.selected = null;
  if (quizState.current >= quizState.questions.length) {
    quizState.questions = [];
  } else if (quizState.type === 'listening') {
    setTimeout(() => speak(quizState.questions[quizState.current].question), 300);
  }
  render();
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function getRandomItems(arr, n) {
  return shuffle(arr).slice(0, n);
}

// ========== 단어장 추가 기능 ==========
function getNotebookKey() {
  return 'notebook_' + currentProfile + '_data';
}

function addToNotebook(item) {
  const nb = JSON.parse(localStorage.getItem(getNotebookKey()) || '{}');
  const today = new Date().toISOString().split('T')[0];
  if (!nb[today]) nb[today] = [];
  
  // 중복 체크
  const exists = nb[today].some(x => JSON.stringify(x) === JSON.stringify({...item, date: undefined}));
  if (exists) {
    showToast('이미 추가된 항목이에요!', '#FF9800');
    return;
  }
  
  nb[today].push(item);
  localStorage.setItem(getNotebookKey(), JSON.stringify(nb));
  showToast('📖 단어장에 추가했어요!', '#4CAF50');
}

function showToast(msg, color) {
  const toast = document.createElement('div');
  toast.className = 'add-toast';
  toast.style.background = color || '#4CAF50';
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}

function confirmAddToNotebook(item) {
  if (confirm('단어장에 추가할까요?')) {
    addToNotebook(item);
  }
}

// 더블클릭 이벤트 위임
document.addEventListener('dblclick', function(e) {
  // 한자 카드
  const kanjiCard = e.target.closest('.kanji-card');
  if (kanjiCard) {
    const k = kanjiCard.dataset.kanji;
    const data = (state.level === 'n5' ? N5_KANJI : N4_KANJI).find(x => x.k === k);
    if (data) {
      confirmAddToNotebook({
        type: 'kanji',
        kanji: data.k,
        onyomi: data.o,
        kunyomi: data.u,
        meaning: data.m,
        reading: data.o?.replace(/[()]/g,'') || data.u?.replace(/[()]/g,''),
        example: data.ex
      });
    }
    return;
  }
  
  // 어휘 카드
  const vocabCard = e.target.closest('.vocab-card');
  if (vocabCard) {
    const jp = vocabCard.dataset.jp;
    const vocabData = state.level === 'n5' ? N5_VOCAB : N4_VOCAB;
    let found = null;
    Object.values(vocabData).forEach(cat => {
      const item = cat.items.find(x => x.jp === jp);
      if (item) found = item;
    });
    if (found) {
      confirmAddToNotebook({
        type: 'vocab',
        jp: found.jp,
        reading: found.n || '',
        kr: found.kr
      });
    }
    return;
  }
  
  // 문법 카드
  const grammarCard = e.target.closest('.grammar-card');
  if (grammarCard) {
    const pt = grammarCard.dataset.pattern;
    const data = (state.level === 'n5' ? N5_GRAMMAR : N4_GRAMMAR).find(x => x.pt === pt);
    if (data) {
      confirmAddToNotebook({
        type: 'grammar',
        pattern: data.pt,
        meaning: data.m,
        desc: data.d,
        examples: data.ex
      });
    }
    return;
  }
});

// ========== 초기화 ==========
// URL 파라미터로 레벨 설정
const urlParams = new URLSearchParams(window.location.search);
const levelParam = urlParams.get('level');
if (levelParam === 'n5' || levelParam === 'n4') {
  state.level = levelParam;
}

loadProgress();
render();
</script>

<!-- Firebase 동기화 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgphZ8FIOMY6vMhcUbg8ZvqkpxxZ_untI",
  authDomain: "jp-tutor-7a967.firebaseapp.com",
  projectId: "jp-tutor-7a967",
  storageBucket: "jp-tutor-7a967.firebasestorage.app",
  messagingSenderId: "937449734884",
  appId: "1:937449734884:web:7827046017d4496363a2f1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

window.firebaseUser = null;
window.syncStatus = 'synced';

window.handleLogin = async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    window.firebaseUser = result.user;
    const docSnap = await getDoc(doc(db, 'users', window.firebaseUser.uid));
    if (docSnap.exists()) {
      await downloadFromCloud();
    } else {
      await uploadToCloud();
      render();
    }
  } catch (e) { alert('로그인 실패'); }
};

window.handleLogout = async () => {
  await signOut(auth);
  window.firebaseUser = null;
  document.getElementById('userDropdown')?.classList.remove('show');
  render();
};

window.toggleUserMenu = () => {
  document.getElementById('userDropdown')?.classList.toggle('show');
};

window.syncNow = async () => {
  document.getElementById('userDropdown')?.classList.remove('show');
  await uploadToCloud();
  alert('동기화 완료!');
};

async function uploadToCloud() {
  if (!window.firebaseUser) return;
  window.syncStatus = 'syncing'; render();
  const allData = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    allData[key] = localStorage.getItem(key);
  }
  await setDoc(doc(db, 'users', window.firebaseUser.uid), { data: allData, updatedAt: new Date().toISOString() });
  window.syncStatus = 'synced'; render();
}

async function downloadFromCloud() {
  if (!window.firebaseUser) return;
  window.syncStatus = 'syncing';
  const docSnap = await getDoc(doc(db, 'users', window.firebaseUser.uid));
  if (docSnap.exists()) {
    const cloudData = docSnap.data().data;
    for (const [key, value] of Object.entries(cloudData)) localStorage.setItem(key, value);
    location.reload();
  }
  window.syncStatus = 'synced';
}

let saveTimeout = null;
window.autoSaveToCloud = () => {
  if (!window.firebaseUser) return;
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(uploadToCloud, 3000);
};

onAuthStateChanged(auth, (user) => {
  window.firebaseUser = user;
  if (typeof render === 'function') render();
});

document.addEventListener('click', (e) => {
  if (!e.target.closest('.dropdown')) document.getElementById('userDropdown')?.classList.remove('show');
});

// 페이지 숨겨질 때 저장
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden' && window.firebaseUser) {
    uploadToCloud();
  }
});
</script>
</body>
</html>
